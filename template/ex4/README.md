(テーマ) バイナリファイルの読みだし
===================================

バイナリファイルを読むプログラムを書く。
サンプル例はbs/freadにある。バイナリファイルはbs/sample.datにある(これは
実習に使うボードから読んだデータ)。

バイナリファイルはテキストファイルと違って行の概念がないので
どこまで読めばよいのか自動できめることができない。読むバイト数を指定する必要がある。

ファイルを読む前にfopen()する必要がある(テキストファイルと同様)。

    #include <stdio.h>
    
    FILE *fp = fopen("filename", "r");
    if (fp == NULL) {
        // エラー処理
    }

エラー処理の方法はいろいろあるだろうが、ここではerr()関数を使う。

    err(1, "fopen");

とすると

    progname: fopen: 失敗した理由

が標準エラー出力にでてくる。
openできたらfread()関数を使って読む。

    char buf[1024];
    int n = fread(buf, 1 /* bytes */, 128, fp);

とすると、「1バイトのオブジェクト」を「128個」読むのを試みる。
戻り値はよみとった「オブジェクト数」。
128バイト読むには、他に

    fread(buf, 8, 16, fp); // 8バイトを16個読む
    fread(buf, 16, 8, fp); // 16バイトを8個読む

というのも考えられる。戻り値がそれぞれ違う(一番下の例では128バイト
読めたときに16を返す)。通常何バイト読めたか知りたいことが多いと思うので
第2引数は1を指定するのがよいかと思う。

ファイル終端などリクエストしたバイト数未満しか読めない場合はエラーとはならず
読み取ったオブジェクト数を返す。

0が返ってきた場合の状態は

* エラー
* ファイル終端まで達した(EOF)

のふたつがあり、戻り値だけでは区別がつかない。man freadでRETRUN VALUEの
ところを読むこと。エラー、EOFの判定にはferror()、feof()関数を使えと
書いてある。

